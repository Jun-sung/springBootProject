<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.safehome.mapper.MyPageMapper">

 <!-- 내 질문글 목록: createdAt은 날짜만 -->
    <select id="findMyQuestions" resultType="com.safehome.domain.qna.Question">
        SELECT
            q.id,
            q.user_id AS userId,
            q.title,
            q.content,
            DATE_FORMAT(q.created_at, '%Y-%m-%d') AS createdAt,

            -- user 테이블에서 이메일 조회
            u.email AS email,

            a.id AS answerId,
            a.admin_id AS answerAdminId,
            a.content AS answerContent,
            DATE_FORMAT(a.created_at, '%Y-%m-%d') AS answerCreatedAt,

            CASE WHEN a.id IS NULL THEN FALSE ELSE TRUE END AS answered

        FROM question q
        JOIN user u ON u.id = q.user_id
        LEFT JOIN answer a ON q.id = a.question_id
        WHERE q.user_id = #{userId}
        ORDER BY q.created_at DESC
    </select>


    <!-- 비밀번호 해시 조회 (user 테이블 기준) -->
    <select id="findPasswordHashByUserId" resultType="string">
        SELECT password
        FROM user
        WHERE id = #{userId}
    </select>

    <!-- 비밀번호 업데이트 -->
    <update id="updatePassword">
        UPDATE user
        SET password = #{newHash}
        WHERE id = #{userId}
    </update>








</mapper>